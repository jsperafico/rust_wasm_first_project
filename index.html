<!DOCTYPE html>
<html>
    <header>
        <title>How about game of life?</title>
        <style>
            body {
              position: absolute;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              display: flex;
              flex-direction: column;
              align-items: center;
              justify-content: center;
            }
          </style>
        <script>
            const wasmBrowserInstantiate = async (wasmModuleUrl, importObject) => {
                let response = undefined;

                if (!importObject) {
                    importObject = {
                        env: {
                            abort: () => console.log("Abort!")
                        }
                    };
                }

                if (WebAssembly.instantiateStreaming) {
                    response = await WebAssembly.instantiateStreaming(fetch(wasmModuleUrl), importObject);
                } else {
                    let fetchAndInstantite = async () => {
                        let wasmArrayBuffer = await fetch(wasmModuleUrl).then( respnse => respnse.arrayBuffer());
                        return WebAssembly.instantiate(wasmArrayBuffer, importObject);
                    }
                    response = await fetchAndInstantite();
                }
                return response;
            }
        </script>
        <script>
            let universe = null;
            let wasmExports = null;
            async function loadWasm() {
                let wasmModule = await wasmBrowserInstantiate("pkg/rust_wasm_first_project_bg.wasm");
                wasmExports = wasmModule.instance.exports
            }
            loadWasm();
            
            window.requestAnimationFrame(function() {
                if (wasmExports != null && wasmExports.Universe != null) {
                    universe = wasmExports.Universe.new();
                    
                    var pre = document.getElementsByTagName("pre")[0];
                    pre.textContent = universe.render();
                    universe.tick();
                }
            });
        </script>
    </header>
    <body>
        <pre></pre>
    </body>
</html>