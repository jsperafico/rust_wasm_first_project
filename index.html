<!DOCTYPE html>
<html>
    <header>
        <title>This is an example of an webassembly usage</title>
        <script>
            const wasmBrowserInstantiate = async (wasmModuleUrl, importObject) => {
                let response = undefined;

                if (!importObject) {
                    importObject = {
                        env: {
                            abort: () => console.log("Abort!")
                        }
                    };
                }

                if (WebAssembly.instantiateStreaming) {
                    response = await WebAssembly.instantiateStreaming(fetch(wasmModuleUrl), importObject);
                } else {
                    let fetchAndInstantite = async () => {
                        let wasmArrayBuffer = await fetch(wasmModuleUrl).then( respnse => respnse.arrayBuffer());
                        return WebAssembly.instantiate(wasmArrayBuffer, importObject);
                    }
                    response = await fetchAndInstantite();
                }
                return response;
            }
        </script>
        <script>
            let wasmExports = null;
            async function loadWasm() {
                let wasmModule = await wasmBrowserInstantiate("pkg/rust_wasm_first_project_bg.wasm");
                wasmExports = wasmModule.instance.exports
            }
            loadWasm();
            
            window.onload = function() {
                var h2 = document.getElementsByTagName("h2")[0];
                document.getElementsByTagName("button")[0].addEventListener("click", function () {
                    h2.textContent = wasmExports.add(1, 4);
                });
            };
        </script>
    </header>
    <body>
        <button>Click me!</button>
        <h1>Result:</h1>
        <h2></h2>
    </body>
</html>