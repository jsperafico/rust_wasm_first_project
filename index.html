<!DOCTYPE html>
<html>
    <header>
        <title>How about game of life?</title>
        <style>
            body {
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                display: grid;
                grid-template-areas: 
                        "fps1 game1" 
                        "fps2 game2";
                grid-template-columns: 150px auto;
                grid-template-rows: auto;
            }
            h1 {
                grid-area: fps1;
            }
            pre {
                grid-area: game1;
            }
        </style>
        <script type='module'>
            import init, {Cell, Universe} from './package/rust_wasm_first_project.js';

            async function run() {
                await init();
                const pre = document.getElementsByTagName('pre')[0];
                const h1 = document.getElementsByTagName('h1')[0];
                const universe = Universe.new();

                const times = [];

                function render(timestamp) {
                    const now = performance.now();
                    while (times.length > 0 && times[0] <= now - 1000) {
                        times.shift();
                    }
                    times.push(now);
                    h1.innerHTML = 'FPS: ' + times.length;

                    pre.textContent = universe.render();
                    universe.tick();

                    window.requestAnimationFrame(render);
                }
                render();
            }
            run();
        </script>
    </header>
    <body>
        <h1>FPS:</h1>
        <pre></pre>
    </body>
</html>